<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè¢</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <title>Busca de Empresas e CNPJ</title>
    <style>
        /* Estilos Gerais */
        :root {
            --blue-primary: #2563eb;
            --blue-secondary: #1e40af;
            --blue-light: #bfdbfe;
            --white: #ffffff;
            --gray-dark: #1f2937;
            --gray-medium: #4b5563;
            --gray-light: #f3f4f6;
            --accent: #f59e0b;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 15px rgba(0, 0, 0, 0.03);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1), 0 5px 10px rgba(0, 0, 0, 0.04);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --transition: all 0.2s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            min-height: 100vh;
            background: linear-gradient(135deg, #1e40af, #2563eb, #3b82f6);
            background-size: 200% 200%;
            animation: gradientAnimation 15s ease infinite;
            color: var(--gray-dark);
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align items to the top */
            padding-top: 2rem; /* Add padding to the top */
        }

        @keyframes gradientAnimation {
            0% {background-position: 0% 50%;}
            50% {background-position: 100% 50%;}
            100% {background-position: 0% 50%;}
        }
        
        .page-wrapper {
            width: 100%;
            max-width: 1200px;
            padding: 2rem;
            margin: 0 auto; /* Remove top/bottom margin */
        }
       
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
            width: 100%;
        }

        /* Cabe√ßalho */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--blue-light);
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100px;
            height: 2px;
            background-color: var(--blue-primary);
        }

        .header h1 {
            color: var(--blue-secondary);
            font-weight: 700;
            font-size: 2.2rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .header h1 i {
            color: var(--blue-primary);
            font-size: 1.8rem;
        }
        
        .logo {
            height: 60px; /* Adjusted size */
            width: auto;
            transition: var(--transition);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
            margin-right: 10px;
        }

        .logo:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
        }

        /* Se√ß√µes de Busca (Comum) */
        .search-container {
            background-color: var(--white);
            padding: 2rem;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            border: 1px solid var(--gray-light);
            box-shadow: var(--shadow-md);
            transition: var(--transition);
        }

        .search-container:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .search-container h2 {
            color: var(--blue-primary);
            margin-top: 0;
            margin-bottom: 1.5rem;
            font-size: 1.6rem;
            font-weight: 600;
            border-bottom: 2px solid var(--blue-light);
            padding-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .search-container h2 i {
            color: var(--blue-primary);
        }

        /* HubSpot Search */
        .hubspot-search-container {
            background: linear-gradient(to right, rgba(255, 255, 255, 0.95), rgba(191, 219, 254, 0.3));
            border-left: 4px solid var(--blue-primary);
        }

        /* CNPJ Search */
        .cnpj-search-container {
            background: linear-gradient(to right, rgba(255, 255, 255, 0.95), rgba(243, 244, 246, 0.5));
            border-left: 4px solid var(--gray-medium);
        }

        .search-input-group {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 1rem;
        }

        /* Campo de Busca */
        .search-input {
            flex-grow: 1;
            padding: 0.9rem 1.2rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
            color: var(--gray-dark);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--blue-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        .search-input::placeholder {
            color: var(--gray-medium);
            opacity: 0.7;
        }

        /* Bot√µes */
        .button {
            padding: 0.9rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.6rem;
            box-shadow: var(--shadow-sm);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 120px;
        }

        .button i {
            font-size: 1.1em;
        }

        .search-button {
            background-color: var(--blue-primary);
            color: var(--white);
        }

        .search-button:hover {
            background-color: var(--blue-secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .clear-button {
            background-color: var(--gray-medium);
            color: var(--white);
        }

        .clear-button:hover {
            background-color: var(--gray-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Lista de Resultados */
        .results-list {
            margin-top: 1.5rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-md);
            background: var(--white);
            max-height: 280px;
            overflow-y: auto;
            list-style: none;
            padding: 0;
            box-shadow: var(--shadow-sm);
            display: none; /* Hide by default */
        }

        .result-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-light);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--gray-dark);
            position: relative;
            overflow: hidden;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-item:hover {
            background: linear-gradient(to right, var(--blue-light), rgba(191, 219, 254, 0.2));
            transform: translateX(5px);
            color: var(--blue-secondary);
        }

        .result-item::before {
            content: "\f1ad";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            font-size: 1.3em;
            color: var(--blue-primary);
            opacity: 0.8;
            min-width: 20px;
        }

        .result-item::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background-color: transparent;
            transition: var(--transition);
        }

        .result-item:hover::after {
            background-color: var(--blue-primary);
        }

        /* Detalhes da Empresa */
        .details-section {
            background: rgb(156, 227, 176);
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-top: 2rem;
            animation: fadeIn 0.4s ease-out;
            box-shadow: var(--shadow-md);
            display: none; /* Hide by default */
        }

        .details-section h2 {
            color: var(--blue-secondary);
            margin-top: 0;
            margin-bottom: 1.8rem;
            font-size: 1.7rem;
            font-weight: 600;
            border-bottom: 2px solid var(--blue-light);
            padding-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .details-section h2 i {
            color: var(--blue-primary);
        }

        .details-section h3 {
            color: var(--gray-dark);
            margin-top: 2rem;
            margin-bottom: 1.2rem;
            font-size: 1.3rem;
            font-weight: 600;
            padding-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            position: relative;
        }

        .details-section h3:first-of-type {
            margin-top: 0; /* Remove top margin for the first h3 */
        }

        .details-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 2px;
            background-color: var(--blue-light);
        }

        .details-section h3 i {
            color: var(--blue-primary);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.2rem;
        }

        .info-item {
            background: var(--gray-light);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: var(--radius-md);
            padding: 1.2rem;
            box-shadow: var(--shadow-sm);
            font-size: 0.95rem;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        .info-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: linear-gradient(to right, var(--gray-light), rgba(255, 255, 255, 0.9));
        }

        .label {
            color: var(--blue-primary);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            display: block;
        }

        .value {
            word-break: break-word;
            color: var(--gray-dark);
            font-weight: 500;
        }

        .socio-details {
            margin-top: 0.8rem;
            padding-top: 0.8rem;
            border-top: 1px solid var(--gray-light);
            font-size: 0.9em;
            color: var(--gray-medium);
        }

        /* Scrollbar Customizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-light);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--blue-light);
            border-radius: 10px;
            border: 2px solid var(--gray-light);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--blue-primary);
        }

        /* Anima√ß√µes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Mensagens de Erro/Status */
        .message {
            padding: 1rem 1.5rem;
            border-radius: var(--radius-md);
            margin-top: 1.5rem;
            font-weight: 500;
            display: none; /* Oculto por padr√£o */
            border: 1px solid transparent;
            align-items: center;
            gap: 0.8rem;
            font-size: 0.95rem;
            animation: fadeIn 0.3s ease-out;
        }

        .message i {
            font-size: 1.3em;
        }

        .error {
            background-color: #fee2e2;
            color: #b91c1c;
            border-color: #fecaca;
            display: flex; /* Ensure flex is applied when class is added */
        }

        .loading {
            background-color: #e0f2fe;
            color: #0369a1;
            border-color: #bae6fd;
            display: flex; /* Ensure flex is applied when class is added */
        }

        .success {
            background-color: #dcfce7;
            color: #15803d;
            border-color: #bbf7d0;
            display: flex; /* Ensure flex is applied when class is added */
        }

        /* Badges e Indicadores */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 0.5rem;
        }

        .badge-blue {
            background-color: var(--blue-light);
            color: var(--blue-secondary);
        }

        .badge-gray {
            background-color: var(--gray-light);
            color: var(--gray-medium);
        }

        .badge-accent {
            background-color: rgba(245, 158, 11, 0.2);
            color: var(--accent);
        }

        /* Efeitos de Hover e Foco */
        .hover-lift {
            transition: var(--transition);
        }

        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Responsividade */
        @media (max-width: 1024px) {
            .page-wrapper {
                padding: 1.5rem;
                margin: 1.5rem auto;
            }
            
            .container {
                padding: 2rem;
            }
        }

        @media (max-width: 768px) {
            .page-wrapper {
                padding: 1rem;
                margin: 1rem auto;
            }
            
            .container {
                padding: 1.5rem;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .logos {
                align-self: flex-start;
                margin-top: 0.5rem;
            }
            
            .logo {
                height: 50px;
            }
            
            .search-input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .button {
                width: 100%;
                justify-content: center;
                margin-top: 0.7rem;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .page-wrapper {
                padding: 0.5rem;
                margin: 0.5rem auto;
            }
            
            .container {
                padding: 1.2rem;
                border-radius: var(--radius-md);
            }
            
            .search-container {
                padding: 1.5rem;
            }
            
            .header h1 {
                font-size: 1.6rem;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="container">
            <!-- Cabe√ßalho -->
            <div class="header">
                <h1><i class="fas fa-building"></i> Busca Integrada</h1>
                <div class="logos">
                    <!-- Logo HubSpot -->
                    <img src="data:image/jpeg;base64,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"
                         class="logo" alt="HubSpot Logo">
                </div>
            </div>

            <!-- Se√ß√£o de Busca HubSpot -->
            <div class="search-container hubspot-search-container">
                <h2><i class="fas fa-search"></i> Busca HubSpot</h2>
                <div class="search-input-group">
                    <input type="text" class="search-input" placeholder="Digite o nome da empresa..." id="hubspot-search">
                    <button class="button search-button" id="hubspot-search-btn">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                    <button class="button clear-button" id="hubspot-clear-btn">
                        <i class="fas fa-times"></i> Limpar
                    </button>
                </div>
                <div class="message" id="hubspot-message" style="display: none;"></div>
                <ul class="results-list" id="hubspot-results">
                    <!-- Resultados ser√£o inseridos aqui -->
                </ul>
            </div>

            <!-- Se√ß√£o de Busca CNPJ -->
            <div class="search-container cnpj-search-container">
                <h2><i class="fas fa-id-card"></i> Busca CNPJ</h2>
                <div class="search-input-group">
                    <input type="text" class="search-input" placeholder="Digite o CNPJ (apenas n√∫meros)..." id="cnpj-search">
                    <button class="button search-button" id="cnpj-search-btn">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                    <button class="button clear-button" id="cnpj-clear-btn">
                        <i class="fas fa-times"></i> Limpar
                    </button>
                </div>
                 <div class="message" id="cnpj-message" style="display: none;"></div>
            </div>

            <!-- Se√ß√£o de Detalhes da Empresa -->
            <div class="details-section hubspot" id="company-details">
                <!-- Detalhes ser√£o preenchidos pelo JS -->
            </div>

            <div class="details-section api-publica" id="company-details">
                <!-- Detalhes ser√£o preenchidos pelo JS -->
            </div>
        </div>
    </div>

    <script>
        // --- Configura√ß√µes --- //
        const API_URL_HUBSPOT = 'https://api-hubspot.vercel.app'; // !!! SUBSTITUA PELO SEU ENDPOINT REAL !!!
        const API_URL_CNPJ = 'https://publica.cnpj.ws/cnpj/'; // API P√∫blica

        // --- Elementos DOM --- //
        const hubspotSearchInput = document.getElementById('hubspot-search');
        const hubspotSearchButton = document.getElementById('hubspot-search-btn');
        const hubspotClearButton = document.getElementById('hubspot-clear-btn');
        const hubspotResultsList = document.getElementById('hubspot-results');
        const hubspotMessageElement = document.getElementById('hubspot-message');

        const cnpjSearchInput = document.getElementById('cnpj-search');
        const cnpjSearchButton = document.getElementById('cnpj-search-btn');
        const cnpjClearButton = document.getElementById('cnpj-clear-btn');
        const cnpjMessageElement = document.getElementById('cnpj-message');
        
        const companyDetailsSection = document.getElementById('company-details');

        // --- Event Listeners --- //
        let hubspotSearchTimeout;
        hubspotSearchInput.addEventListener('input', () => {
            clearTimeout(hubspotSearchTimeout);
            // Adiciona um pequeno delay para n√£o buscar a cada tecla
            hubspotSearchTimeout = setTimeout(() => {
                 handleHubspotSearch();
            }, 300); 
        });

        hubspotSearchButton.addEventListener('click', handleHubspotSearch);
        hubspotClearButton.addEventListener('click', clearHubspotSearch);

        cnpjSearchButton.addEventListener('click', handleCnpjSearch);
        cnpjClearButton.addEventListener('click', clearCnpjSearch);
        cnpjSearchInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                handleCnpjSearch();
            }
        });

        // --- Fun√ß√µes para Consulta HubSpot --- //
        async function handleHubspotSearch() {
            const searchTerm = hubspotSearchInput.value.trim();
            hubspotResultsList.innerHTML = '';
            hubspotResultsList.style.display = 'none';
            companyDetailsSection.style.display = 'none';
            hideMessage(hubspotMessageElement);

            if (searchTerm.length < 3) { // N√£o busca com menos de 3 caracteres
                if (searchTerm.length > 0) {
                    showMessage(hubspotMessageElement, 'Digite pelo menos 3 caracteres para buscar.', 'error');
                }
                return;
            }

            showMessage(hubspotMessageElement, 'Buscando no HubSpot...', 'loading');

            try {
                // !!! IMPORTANTE: Adapte esta chamada √† sua API real !!!
                const response = await fetch(`${API_URL_HUBSPOT}/api/search`, { // Exemplo de endpoint
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // Adicione headers de autentica√ß√£o se necess√°rio
                    },
                    body: JSON.stringify({ searchTerm })
                });
    
                if (!response.ok) {
                    const errorText = await response.text();
                    let errorMessage = `Erro HTTP: ${response.status}`;
                    try { 
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.error || errorData.message || errorMessage;
                    } catch (e) { /* Ignora se n√£o for JSON */ }
                    throw new Error(errorMessage);
                }
                    
                const results = await response.json();
                displayHubspotResults(results);
                hideMessage(hubspotMessageElement);

            } catch (error) {
                console.error('Erro na busca HubSpot:', error);
                showMessage(hubspotMessageElement, `Erro na busca HubSpot: ${error.message}`, 'error');
                hubspotResultsList.style.display = 'none';
            }
        }
    
        // Exibe os resultados da busca HubSpot
        function displayHubspotResults(results) {
            hubspotResultsList.innerHTML = '';
            if (!results || results.length === 0) {
                const li = document.createElement('li');
                li.className = 'result-item';
                li.textContent = 'Nenhuma empresa encontrada no HubSpot.';
                hubspotResultsList.appendChild(li);
                hubspotResultsList.style.display = 'block';
                return;
            }

            results.forEach(company => {
                const li = document.createElement('li');
                li.className = 'result-item';
                
                // Adapte as propriedades conforme sua API HubSpot retorna
                const props = company.properties || company; 
                const name = props.name || 'Nome n√£o dispon√≠vel';
                const city = props.city || '';
                const state = props.state || '';
                const location = city || state ? ` - ${city}${state ? '/' + state : ''}` : '';
                const cnpj = props.cnpj_inteiro ? ` (CNPJ: ${formatCnpj(props.cnpj_inteiro)})` : ''; // Assumindo que tem CNPJ
                
                li.textContent = `${name}${location}${cnpj}`;
                
                // Adapte o ID ou a forma de carregar detalhes
                li.onclick = () => loadHubspotCompanyDetails(company.id || props.hs_object_id); 
                hubspotResultsList.appendChild(li);
            });
            hubspotResultsList.style.display = 'block';
        }
        
        // Carrega detalhes da empresa selecionada no HubSpot
        async function loadHubspotCompanyDetails(companyId) {
            showMessage(hubspotMessageElement, 'Carregando detalhes do HubSpot...', 'loading');
            companyDetailsSection.innerHTML = ''; // Limpa detalhes anteriores
            companyDetailsSection.style.display = 'none';

            try {
                 // !!! IMPORTANTE: Adapte esta chamada √† sua API real !!!
                const response = await fetch(`${API_URL_HUBSPOT}/company/${companyId}`); // Exemplo
                
                if (!response.ok) {
                    const errorText = await response.text();
                    let errorMessage = `Erro HTTP: ${response.status}`;
                     try { 
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.error || errorData.message || errorMessage;
                    } catch (e) { /* Ignora se n√£o for JSON */ }
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                displayCompanyDetails(data.properties || data, 'HubSpot'); // Passa 'HubSpot' como origem
                hideMessage(hubspotMessageElement);
                hubspotResultsList.innerHTML = '';
                hubspotResultsList.style.display = 'none';

            } catch (error) {
                console.error('Erro ao carregar detalhes HubSpot:', error);
                showMessage(hubspotMessageElement, `Erro ao carregar detalhes: ${error.message}`, 'error');
                companyDetailsSection.style.display = 'none';
            }
        }

        // Fun√ß√£o para limpar a busca HubSpot
        function clearHubspotSearch() {
            hubspotSearchInput.value = '';
            hubspotResultsList.innerHTML = '';
            hubspotResultsList.style.display = 'none';
            companyDetailsSection.style.display = 'none';
            hideMessage(hubspotMessageElement);
        }

        // --- Fun√ß√µes para Consulta CNPJ (API P√∫blica) --- //
        async function handleCnpjSearch() {
            const cnpjValue = cnpjSearchInput.value.replace(/\D/g, ''); // Remove n√£o d√≠gitos
            companyDetailsSection.innerHTML = ''; // Limpa detalhes anteriores
            companyDetailsSection.style.display = 'none';
            hideMessage(cnpjMessageElement);

            if (cnpjValue.length !== 14) {
                showMessage(cnpjMessageElement, 'Por favor, digite um CNPJ v√°lido com 14 n√∫meros.', 'error');
                return;
            }

            showMessage(cnpjMessageElement, 'Consultando CNPJ na Receita Federal...', 'loading');

            try {
                const response = await fetch(`${API_URL_CNPJ}${cnpjValue}`);

                if (response.status === 404) {
                     throw new Error('CNPJ n√£o encontrado na base de dados.');
                } else if (response.status === 429) {
                    throw new Error('Muitas requisi√ß√µes. Tente novamente mais tarde.');
                } else if (!response.ok) {
                    let errorMsg = `Erro ${response.status}`; 
                    try {
                        const errorData = await response.json();
                        errorMsg += `: ${errorData?.message || response.statusText}`;
                    } catch(e) { errorMsg += `: ${response.statusText}`; }
                    throw new Error(errorMsg);
                }

                const data = await response.json();
                displayCompanyDetails(data, 'CNPJ'); // Passa 'CNPJ' como origem
                hideMessage(cnpjMessageElement);

            } catch (error) {
                console.error('Erro na consulta CNPJ:', error);
                showMessage(cnpjMessageElement, `Erro na consulta CNPJ: ${error.message}`, 'error');
                companyDetailsSection.style.display = 'none';
            }
        }

        // Fun√ß√£o para limpar a busca CNPJ
        function clearCnpjSearch() {
            cnpjSearchInput.value = '';
            companyDetailsSection.style.display = 'none';
            hideMessage(cnpjMessageElement);
        }

        // --- Fun√ß√µes Comuns --- //

        // Exibe os detalhes da empresa (adaptado para ambas as fontes)
        function displayCompanyDetails(data, source) {
            companyDetailsSection.innerHTML = ''; // Limpa conte√∫do anterior
            companyDetailsSection.style.display = 'block';

            const title = document.createElement('h2');
            title.innerHTML = `<i class="fas fa-building"></i> Detalhes da Empresa (${source})`;
            companyDetailsSection.appendChild(title);

            // Mapeamento de campos (exemplo, ajuste conforme necess√°rio)
            const detailsMap = {
                'Informa√ß√µes B√°sicas': {
                    icon: 'fa-info-circle',
                    fields: {
                        'Raz√£o Social': source === 'CNPJ' ? data.razao_social : data.name,
                        'Nome Fantasia': source === 'CNPJ' ? data.estabelecimento?.nome_fantasia : data.nome_fantasia, // Exemplo
                        'CNPJ': source === 'CNPJ' ? formatCnpj(data.estabelecimento?.cnpj) : formatCnpj(data.cnpj_inteiro),
                        'Situa√ß√£o': source === 'CNPJ' ? data.estabelecimento?.situacao_cadastral : data.situacao, // Exemplo
                        'C√≥digo Cliente (HubSpot)': source === 'HubSpot' ? data.codigo_cliente : null // Campo espec√≠fico HubSpot
                    }
                },
                'Endere√ßo': {
                    icon: 'fa-map-marker-alt',
                    fields: {
                        'Logradouro': source === 'CNPJ' ? data.estabelecimento?.logradouro : data.address,
                        'N√∫mero': source === 'CNPJ' ? data.estabelecimento?.numero : data.address_number,
                        'Complemento': source === 'CNPJ' ? data.estabelecimento?.complemento : data.address_complement,
                        'Bairro': source === 'CNPJ' ? data.estabelecimento?.bairro : data.address_district,
                        'Cidade': source === 'CNPJ' ? data.estabelecimento?.cidade?.nome : data.city,
                        'UF': source === 'CNPJ' ? data.estabelecimento?.estado?.sigla : data.state,
                        'CEP': source === 'CNPJ' ? formatCep(data.estabelecimento?.cep) : data.zip
                    }
                },
                'Contato': {
                    icon: 'fa-phone-alt',
                    fields: {
                        'Telefone': source === 'CNPJ' ? formatPhone(data.estabelecimento?.ddd1, data.estabelecimento?.telefone1) : data.phone,
                        'Email': source === 'CNPJ' ? data.estabelecimento?.email : data.email
                    }
                },
                'Atividades': {
                    icon: 'fa-briefcase',
                    fields: {
                        'Atividade Principal': source === 'CNPJ' ? data.estabelecimento?.atividade_principal?.descricao : data.industry,
                        'Atividades Secund√°rias': source === 'CNPJ' ? (data.estabelecimento?.atividades_secundarias?.map(a => a.descricao).join(', ') || null) : null
                    }
                },
                 'S√≥cios (QSA)': {
                    icon: 'fa-users',
                    isList: true,
                    source: 'CNPJ', // S√≥cios v√™m apenas da API CNPJ
                    items: data.socios
                }
            };

            // Fun√ß√£o auxiliar para criar e adicionar um item de informa√ß√£o ao grid
            function addInfoItem(grid, label, value) {
                if (value !== null && value !== undefined && value !== '') {
                    const infoItem = document.createElement('div');
                    infoItem.classList.add('info-item');
                    infoItem.innerHTML = `<span class="label">${label}</span><span class="value">${value}</span>`;
                    grid.appendChild(infoItem);
                }
            }

            // Renderiza as se√ß√µes e campos
            for (const sectionTitle in detailsMap) {
                const sectionData = detailsMap[sectionTitle];
                
                // Pula se√ß√£o se for espec√≠fica de outra fonte
                if (sectionData.source && sectionData.source !== source) continue;
                
                // Verifica se h√° dados para a se√ß√£o (exceto listas)
                let hasData = false;
                if (!sectionData.isList) {
                    for (const fieldLabel in sectionData.fields) {
                        if (sectionData.fields[fieldLabel] !== null && sectionData.fields[fieldLabel] !== undefined && sectionData.fields[fieldLabel] !== '') {
                            hasData = true;
                            break;
                        }
                    }
                } else {
                    hasData = sectionData.items && sectionData.items.length > 0;
                }

                if (hasData) {
                    const sectionHeader = document.createElement('h3');
                    sectionHeader.innerHTML = `<i class="fas ${sectionData.icon}"></i> ${sectionTitle}`;
                    companyDetailsSection.appendChild(sectionHeader);

                    const grid = document.createElement('div');
                    grid.className = 'info-grid';

                    if (!sectionData.isList) {
                        for (const fieldLabel in sectionData.fields) {
                            addInfoItem(grid, fieldLabel, sectionData.fields[fieldLabel]);
                        }
                    } else {
                        // Renderiza lista (ex: S√≥cios)
                        sectionData.items.forEach(item => {
                            const socioItem = document.createElement('div');
                            socioItem.classList.add('info-item');
                            const qualificacao = item.qualificacao_socio?.descricao || 'S√≥cio';
                            const nome = item.nome || 'Nome n√£o informado';
                            const doc = formatCpfCnpjSocio(item.cpf_cnpj_socio) || 'N√£o informado';
                            const rep = item.nome_representante_legal ? `<div class="socio-details">Representante: ${item.nome_representante_legal} (${item.qualificacao_representante_legal?.descricao || ''})</div>` : '';
                            
                            socioItem.innerHTML = `
                                <span class="label">${qualificacao}:</span>
                                <span class="value">
                                    <div>${nome}</div>
                                    <div class="socio-details">CPF/CNPJ: ${doc}</div>
                                    ${rep}
                                </span>
                            `;
                            grid.appendChild(socioItem);
                        });
                    }
                    companyDetailsSection.appendChild(grid);
                }
            }
        }

        // Formata CNPJ: XX.XXX.XXX/XXXX-XX
        function formatCnpj(cnpj) {
            if (!cnpj) return null;
            cnpj = String(cnpj).replace(/\D/g, '');
            if (cnpj.length === 14) {
                return cnpj.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
            }
            return cnpj; // Retorna sem formata√ß√£o se n√£o tiver 14 d√≠gitos
        }

        // Formata CEP: XXXXX-XXX
        function formatCep(cep) {
            if (!cep) return null;
            const cepString = String(cep).replace(/\D/g, '');
            if (cepString.length === 8) {
                return cepString.replace(/(\d{5})(\d{3})/, '$1-$2');
            }
            return cep; // Retorna original se n√£o tiver 8 d√≠gitos
        }

        // Formata Telefone: (DD) XXXXX-XXXX ou (DD) XXXX-XXXX
        function formatPhone(ddd, phone) {
            if (!ddd || !phone) return null;
            const dddString = String(ddd).replace(/\D/g, '');
            const phoneString = String(phone).replace(/\D/g, '');
            if (phoneString.length === 8) {
                 return `(${dddString}) ${phoneString.substring(0, 4)}-${phoneString.substring(4)}`;
            } else if (phoneString.length === 9) {
                 return `(${dddString}) ${phoneString.substring(0, 5)}-${phoneString.substring(5)}`;
            }
            return `(${dddString}) ${phoneString}`; // Retorna sem formata√ß√£o espec√≠fica se n√£o for 8 ou 9 d√≠gitos
        }

        // Formata CPF/CNPJ do S√≥cio (com m√°scara simples)
        function formatCpfCnpjSocio(doc) {
            if (!doc) return null;
            const docString = String(doc).replace(/\D/g, '');
            if (docString.length === 11) { // CPF
                // Mostra apenas os 3 primeiros e 2 √∫ltimos d√≠gitos
                return `${docString.substring(0, 3)}.***.***-${docString.substring(9, 11)}`;
            } else if (docString.length === 14) { // CNPJ
                return formatCnpj(docString);
            } else {
                return doc; // Retorna original se n√£o for CPF ou CNPJ padr√£o
            }
        }

        // Mostra mensagens de status/erro
        function showMessage(element, text, type) {
            element.textContent = text;
            element.className = `message ${type}`;
            element.style.display = 'flex';
            let iconClass = '';
            if (type === 'loading') iconClass = 'fas fa-spinner fa-spin';
            else if (type === 'error') iconClass = 'fas fa-exclamation-circle';
            else if (type === 'success') iconClass = 'fas fa-check-circle';
            if (iconClass) {
                 element.innerHTML = `<i class="${iconClass}"></i> ${text}`;
            } else {
                 element.innerHTML = text; // Sem √≠cone para tipos n√£o definidos
            }
        }

        // Oculta mensagens
        function hideMessage(element) {
            element.style.display = 'none';
            element.className = 'message'; // Reseta classes
            element.innerHTML = '';
        }

    </script>
</body>
</html>
